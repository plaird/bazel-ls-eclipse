#! /bin/bash
cat $1  | /usr/local/bin/jq '. | {"build_file_artifact_location": .build_file_artifact_location.relative_path, "dependencies": [.deps[].target.label], "generated_jars": [.java_ide_info.generated_jars[]], "jars": [.java_ide_info.jars[] | to_entries | map(select(.key != "source_jars")) | map(. | {"key": .key, "value": .value | (.root_execution_path_fragment + "/" + .relative_path)}) | from_entries], "kind": .kind_string, "label": .key.label, "main_class": .java_ide_info.main_class, "sources": [.java_ide_info.sources[].relative_path]} | to_entries | map(select(.value != null)) | from_entries' > $2
